"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4093],{2896(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/recipe-document-67658ccee96b7123b076faf1af2f3b16.png"},8079(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"showcase/recipe-book","title":"The Auto-Scaling Cookbook","description":"Pattern: Aggregation & Context Scaling","source":"@site/docs/showcase/recipe-book.md","sourceDirName":"showcase","slug":"/showcase/recipe-book","permalink":"/loom/showcase/recipe-book","draft":false,"unlisted":false,"editUrl":"https://github.com/leonieziechmann/loom/tree/main/docs/docs/showcase/recipe-book.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Showcase","permalink":"/loom/category/showcase"},"next":{"title":"The Reactive Character Sheet","permalink":"/loom/showcase/character-sheet"}}');var s=t(4848),o=t(8453);const a={sidebar_position:1},r="The Auto-Scaling Cookbook",l={},c=[{value:"The Challenge",id:"the-challenge",level:2},{value:"The Loom Solution",id:"the-loom-solution",level:2},{value:"1. The User Experience (API)",id:"1-the-user-experience-api",level:2},{value:"2. The Ingredient (The Data Source)",id:"2-the-ingredient-the-data-source",level:2},{value:"3. The Step (Intermediate Aggregation)",id:"3-the-step-intermediate-aggregation",level:2},{value:"4. The Recipe (Global Aggregation)",id:"4-the-recipe-global-aggregation",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"the-auto-scaling-cookbook",children:"The Auto-Scaling Cookbook"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pattern: Aggregation & Context Scaling"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/leonieziechmann/loom/tree/main/showcase/cook-book",children:"View Source Code"})}),"\n",(0,s.jsxs)(n.p,{children:["This showcase demonstrates how Loom can turn a standard text document into a smart application. We will build a recipe template where ",(0,s.jsx)(n.strong,{children:"ingredients are defined inline"})," within the instructions, but automatically generate a ",(0,s.jsx)(n.strong,{children:"Shopping List"})," and ",(0,s.jsx)(n.strong,{children:"Nutrition Table"})," at the top of the page."]}),"\n",(0,s.jsxs)(n.p,{children:["Furthermore, we will add a ",(0,s.jsx)(n.strong,{children:"Scaling Feature"}),": The user writes the recipe for 2 people, but if they compile with ",(0,s.jsx)(n.code,{children:"serves: 4"}),", all amounts (and nutrition values) automatically double."]}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)("img",{src:t(2896).A,alt:"Result of the Recipe Document",style:{width:"80%",border:"1px solid #e5e7eb",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"}})}),"\n",(0,s.jsx)(n.h2,{id:"the-challenge",children:"The Challenge"}),"\n",(0,s.jsx)(n.p,{children:"In standard Typst, this is hard because:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Linearity:"}),' The "Shopping List" appears ',(0,s.jsx)(n.em,{children:"before"})," the ingredients are listed in the text."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scattered Data:"}),' Ingredients are hidden inside paragraphs ("Cut the ',(0,s.jsx)(n.strong,{children:"onions"}),'...").']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Math:"}),' Scaling "2 onions" to "4 onions" requires state management that is brittle in standard Typst.']}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"the-loom-solution",children:"The Loom Solution"}),"\n",(0,s.jsx)(n.p,{children:"We use three Loom patterns working in harmony:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Provider (Context):"})," The ",(0,s.jsx)(n.code,{children:"recipe"})," wrapper calculates a ",(0,s.jsx)(n.code,{children:"scale-factor"})," (e.g., ",(0,s.jsx)(n.code,{children:"Target / Base"}),") and injects it into the Scope."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Smart Components (Ingredients):"})," The ",(0,s.jsx)(n.code,{children:"ing"}),' component reads the scale factor, multiplies its amount, and renders the new value (e.g., "4 onions"). It also ',(0,s.jsx)(n.strong,{children:"emits a signal"})," with its nutrition data."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aggregator (Root):"})," The ",(0,s.jsx)(n.code,{children:"recipe"})," collects these signals to build the lists."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"1-the-user-experience-api",children:"1. The User Experience (API)"}),"\n",(0,s.jsx)(n.p,{children:"First, look at how clean the user's code is. They just write a story."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typ",children:'// my-recipe.typ\n#import "recipe-lib.typ": recipe, step\n#import "ing.typ"\n\n// We write for 2, but serve 4. Loom handles the math.\n#show: recipe.with(\n  title: "Rustic Roasted Tomato Basil Soup",\n  serves: 4,\n  base: 2\n)\n\n#step(1)[\n  Preheat your oven to 200\xb0C.\n  Cut #ing.tomato(750) in half and place them on a baking sheet.\n  Drizzle with #ing.oil(1) and season with #ing.salt_pep(1).\n]\n\n#step(3)[\n  While roasting, chop #ing.onion(0.5).\n  Saut\xe9 until translucent, then add #ing.stock(250).\n]\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"2-the-ingredient-the-data-source",children:"2. The Ingredient (The Data Source)"}),"\n",(0,s.jsx)(n.p,{children:"The ingredient component is the workhorse. It does two things:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Scales"})," the visible amount."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Signals"})," the raw data (normalized) to the parent."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typ",children:'// recipe-lib.typ\n#let ing(name, amount, unit: "", kcal: 0, ..) = managed-motif(\n  "ing",\n  measure: (ctx, _) => {\n    // 1. READ CONTEXT (Provider Pattern)\n    let factor = ctx.at("scale-factor", default: 1.0)\n    let final-amount = amount * factor\n\n    // 2. EMIT SIGNAL (Aggregator Pattern)\n    let signal = (\n      kind: "ing",\n      name: name,\n      amount: final-amount,\n      unit: unit,\n      kcal: kcal * factor\n    )\n\n    // 3. PREPARE VIEW\n    (signal, (amount: final-amount, unit: unit))\n  },\n  draw: (ctx, public, view, _) => {\n    // Render the scaled text (e.g., "1500g")\n    text(fill: orange)[#view.amount#view.unit #name]\n  },\n  none\n)\n\n'})}),"\n",(0,s.jsx)(n.h2,{id:"3-the-step-intermediate-aggregation",children:"3. The Step (Intermediate Aggregation)"}),"\n",(0,s.jsxs)(n.p,{children:["This is a cool detail: The ",(0,s.jsx)(n.code,{children:"step"})," component aggregates ingredients ",(0,s.jsx)(n.em,{children:"locally"}),' to show a "Use in this step" side-note.']}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typ",children:'#let step(number, body) = managed-motif(\n  "step",\n  measure: (ctx, children) => {\n    // Filter only the ingredients inside THIS step\n    let local-ings = children.map(c => c.signal).filter(s => s.kind == "ing")\n\n    // Pass them to the view (but also bubble them up!)\n    (local-ings, (number: number, local-ings: local-ings))\n  },\n  draw: (ctx, public, view, body) => {\n    grid(\n      columns: (30%, 1fr),\n      align(right)[\n        // Sidebar: "Use in this step"\n        #for i in view.local-ings [ #i.amount #i.name \\ ]\n      ],\n      body\n    )\n  },\n  body\n)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"4-the-recipe-global-aggregation",children:"4. The Recipe (Global Aggregation)"}),"\n",(0,s.jsx)(n.p,{children:"Finally, the root component gathers everything to build the Shopping List."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typ",children:"#let recipe-motif(serves, base, body) = managed-motif(\n  \"recipe\",\n  // 1. INJECT SCALING FACTOR\n  scope: (ctx) => ctx + (scale-factor: serves / base),\n\n  measure: (ctx, children) => {\n    // 2. DEEP SEARCH\n    // We collect 'step' signals, which contain arrays of 'ing' signals.\n    // We flatten them to get a master list of all ingredients.\n    let all-ingredients = children.map(c => c.signal).flatten()\n\n    // 3. AGGREGATE (Shopping List)\n    let shopping-list = (:)\n    for item in all-ingredients {\n      let key = item.name\n      let current = shopping-list.at(key, default: 0)\n      shopping-list.insert(key, current + item.amount)\n    }\n\n    // 4. AGGREGATE (Nutrition)\n    let total-kcal = all-ingredients.map(i => i.kcal).sum()\n\n    (none, (shopping: shopping-list, kcal: total-kcal))\n  },\n\n  draw: (ctx, public, view, body) => {\n    // Render the Shopping List & Nutrition Table...\n    // ...then render the body (instructions)\n    render-header(view.shopping)\n    body\n  },\n  body\n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Zero-Boilerplate for Users:"})," The writer doesn't worry about data structures. They just write."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reactive Scaling:"})," Changing one number (",(0,s.jsx)(n.code,{children:"serves: 8"}),") propagates through the entire Context -> Measure -> Draw pipeline automatically."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hybrid Aggregation:"})," We used signals at two levels: locally for the Step sidebar, and globally for the Recipe shopping list."]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453(e,n,t){t.d(n,{R:()=>a,x:()=>r});var i=t(6540);const s={},o=i.createContext(s);function a(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);