"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[9724],{4226(e,s,r){r.r(s),r.d(s,{assets:()=>h,contentTitle:()=>i,default:()=>a,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"api-reference/guards","title":"Guards API","description":"Defensive Architecture","source":"@site/docs/api-reference/guards.md","sourceDirName":"api-reference","slug":"/api-reference/guards","permalink":"/loom/canary/api-reference/guards","draft":false,"unlisted":false,"editUrl":"https://github.com/leonieziechmann/loom/tree/main/docs/docs/api-reference/guards.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Query API","permalink":"/loom/canary/api-reference/query"},"next":{"title":"Mutator API","permalink":"/loom/canary/api-reference/mutator"}}');var d=r(4848),n=r(8453);const c={sidebar_position:4},i="Guards API",h={},l=[{value:"Hierarchy Guards",id:"hierarchy-guards",level:2},{value:"<code>assert-inside</code>",id:"assert-inside",level:3},{value:"<code>assert-not-inside</code>",id:"assert-not-inside",level:3},{value:"<code>assert-direct-parent</code>",id:"assert-direct-parent",level:3},{value:"<code>assert-root</code>",id:"assert-root",level:3},{value:"<code>assert-max-depth</code>",id:"assert-max-depth",level:3},{value:"Context Guards",id:"context-guards",level:2},{value:"<code>assert-has-key</code>",id:"assert-has-key",level:3},{value:"<code>assert-value</code>",id:"assert-value",level:3}];function o(e){const s={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,n.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.header,{children:(0,d.jsx)(s.h1,{id:"guards-api",children:"Guards API"})}),"\n",(0,d.jsx)(s.p,{children:(0,d.jsx)(s.strong,{children:"Defensive Architecture"})}),"\n",(0,d.jsxs)(s.p,{children:["The ",(0,d.jsx)(s.code,{children:"guards"})," module provides a set of assertion functions to enforce the structural integrity of your document. You use these inside the ",(0,d.jsx)(s.code,{children:"measure"})," or ",(0,d.jsx)(s.code,{children:"draw"})," functions of your components to ensure they are being used in the correct context."]}),"\n",(0,d.jsx)(s.admonition,{title:"Critical Behavior",type:"danger",children:(0,d.jsxs)(s.p,{children:["If a guard fails, it will ",(0,d.jsx)(s.strong,{children:"panic"})," with a helpful error message, stopping the compilation immediately. Use guards only for requirements that are non-negotiable for your component's logic."]})}),"\n",(0,d.jsx)(s.h2,{id:"hierarchy-guards",children:"Hierarchy Guards"}),"\n",(0,d.jsxs)(s.p,{children:["These functions check the ",(0,d.jsx)(s.strong,{children:"Path"})," of the current component to ensure it is nested correctly."]}),"\n",(0,d.jsx)(s.h3,{id:"assert-inside",children:(0,d.jsx)(s.code,{children:"assert-inside"})}),"\n",(0,d.jsx)(s.p,{children:"Asserts that the component is nested within at least one of the specified ancestors."}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typ",children:"guards.assert-inside(ctx, ..ancestors)\n"})}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Parameter"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ctx"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"dictionary"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The current context object."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"..ancestors"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"str"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"A list of component kinds (names) allowed as ancestors."})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"assert-not-inside",children:(0,d.jsx)(s.code,{children:"assert-not-inside"})}),"\n",(0,d.jsxs)(s.p,{children:["Asserts that the component is ",(0,d.jsx)(s.strong,{children:"not"})," nested within any of the specified ancestors."]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typ",children:"guards.assert-not-inside(ctx, ..ancestors)\n"})}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Parameter"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ctx"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"dictionary"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The current context object."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"..ancestors"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"str"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"A list of forbidden ancestor component kinds."})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"assert-direct-parent",children:(0,d.jsx)(s.code,{children:"assert-direct-parent"})}),"\n",(0,d.jsxs)(s.p,{children:["Asserts that the ",(0,d.jsx)(s.strong,{children:"immediate"})," parent matches one of the specified kinds. This is stricter than ",(0,d.jsx)(s.code,{children:"assert-inside"}),"."]}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typ",children:"guards.assert-direct-parent(ctx, ..parents)\n"})}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Parameter"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ctx"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"dictionary"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The current context object."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"..parents"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"str"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"A list of allowed direct parent component kinds."})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"assert-root",children:(0,d.jsx)(s.code,{children:"assert-root"})}),"\n",(0,d.jsx)(s.p,{children:"Asserts that the component is at the root of the Loom tree (it has no Loom parents)."}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typ",children:"guards.assert-root(ctx)\n"})}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Parameter"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsx)(s.tbody,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ctx"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"dictionary"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The current context object."})]})})]}),"\n",(0,d.jsx)(s.h3,{id:"assert-max-depth",children:(0,d.jsx)(s.code,{children:"assert-max-depth"})}),"\n",(0,d.jsx)(s.p,{children:"Asserts that the current nesting depth does not exceed a limit."}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typ",children:"guards.assert-max-depth(ctx, max)\n"})}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Parameter"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ctx"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"dictionary"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The current context object."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"max"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"int"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The maximum allowable nesting depth integer."})]})]})]}),"\n",(0,d.jsx)(s.hr,{}),"\n",(0,d.jsx)(s.h2,{id:"context-guards",children:"Context Guards"}),"\n",(0,d.jsxs)(s.p,{children:["These functions validate the data present in the ",(0,d.jsx)(s.code,{children:"ctx"})," dictionary."]}),"\n",(0,d.jsx)(s.h3,{id:"assert-has-key",children:(0,d.jsx)(s.code,{children:"assert-has-key"})}),"\n",(0,d.jsx)(s.p,{children:"Asserts that a specific key exists in the context."}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typ",children:"guards.assert-has-key(ctx, key, msg: none)\n"})}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Parameter"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ctx"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"dictionary"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The current context object."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"key"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"str"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The dictionary key to check for existence."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"msg"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"str"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"none"})}),(0,d.jsx)(s.td,{children:"An optional custom error message to display if the assertion fails."})]})]})]}),"\n",(0,d.jsx)(s.h3,{id:"assert-value",children:(0,d.jsx)(s.code,{children:"assert-value"})}),"\n",(0,d.jsx)(s.p,{children:"Asserts that a context key exists and its value matches one of the allowed options."}),"\n",(0,d.jsx)(s.pre,{children:(0,d.jsx)(s.code,{className:"language-typ",children:"guards.assert-value(ctx, key, ..allowed)\n"})}),"\n",(0,d.jsxs)(s.table,{children:[(0,d.jsx)(s.thead,{children:(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.th,{children:"Parameter"}),(0,d.jsx)(s.th,{children:"Type"}),(0,d.jsx)(s.th,{children:"Default"}),(0,d.jsx)(s.th,{children:"Description"})]})}),(0,d.jsxs)(s.tbody,{children:[(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"ctx"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"dictionary"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The current context object."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"key"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"str"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"The context key to retrieve and check."})]}),(0,d.jsxs)(s.tr,{children:[(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"..allowed"})}),(0,d.jsx)(s.td,{children:(0,d.jsx)(s.code,{children:"any"})}),(0,d.jsx)(s.td,{children:"Required"}),(0,d.jsx)(s.td,{children:"A list of valid values that the context key is allowed to hold."})]})]})]})]})}function a(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,d.jsx)(s,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},8453(e,s,r){r.d(s,{R:()=>c,x:()=>i});var t=r(6540);const d={},n=t.createContext(d);function c(e){const s=t.useContext(n);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:c(e.components),t.createElement(n.Provider,{value:s},e.children)}}}]);